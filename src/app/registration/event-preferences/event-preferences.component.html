<h2 class="form-title">ğŸ… Event Preferences</h2>

<form [formGroup]="preferencesForm" (ngSubmit)="onSubmit()" class="form-container">

  <!-- Common template for any event section -->
  <ng-template #eventSection let-title let-events="events" let-controlName="controlName" let-max="max" let-selected="selected" let-ratings="ratings">
    <mat-card class="section-card">
      <h3>
        {{ title }}
        <span class="selection-count">{{ selected.length }}/{{ max }} selected</span>
      </h3>

      <mat-selection-list [formControlName]="controlName" multiple>
        <mat-list-option *ngFor="let event of events" [value]="event" [disabled]="
          selected.length >= max && !selected.includes(event)
        ">
          {{ event }}
        </mat-list-option>
      </mat-selection-list>

      <mat-hint *ngIf="selected.length > max" class="error-msg">
        âš ï¸ Please select only {{ max }} events.
      </mat-hint>

      <div *ngIf="selected.length === max" class="ratings-section">
        <h4>Rate your skill level for each selected sport/activity</h4>
        <div *ngFor="let event of selected" class="rating-row">
          <span class="event-label">{{ event }}</span>
          <mat-slider
            min="1"
            max="10"
            step="1"
            thumbLabel
            tickInterval="1"
            [(ngModel)]="ratings[event]"
            [name]="event"
            [ngModelOptions]="{ standalone: true }"
          ></mat-slider>
          <span class="rating-value">{{ ratings[event] || 5 }}/10</span>
        </div>
      </div>
    </mat-card>
  </ng-template>

  <!-- Indoor Events -->
  <ng-container *ngTemplateOutlet="eventSection; context: {
    title: 'ğŸ  Indoor Events',
    events: indoorEvents,
    controlName: 'indoorEvents',
    max: 3,
    selected: selectedIndoor,
    ratings: indoorRatings
  }"></ng-container>

  <!-- Outdoor Events -->
  <ng-container *ngTemplateOutlet="eventSection; context: {
    title: 'ğŸŒ³ Outdoor Events',
    events: outdoorEvents,
    controlName: 'outdoorEvents',
    max: 3,
    selected: selectedOutdoor,
    ratings: outdoorRatings
  }"></ng-container>

  <!-- Social Events -->
  <ng-container *ngTemplateOutlet="eventSection; context: {
    title: 'ğŸ‰ Social Events',
    events: socialEvents,
    controlName: 'socialEvents',
    max: 2,
    selected: selectedSocial,
    ratings: socialRatings
  }"></ng-container>

  <!-- Cultural Activities -->
  <ng-container *ngTemplateOutlet="eventSection; context: {
    title: 'ğŸ­ Cultural Activities',
    events: culturalEvents,
    controlName: 'culturalEvents',
    max: 2,
    selected: selectedCultural,
    ratings: culturalRatings
  }"></ng-container>

  <!-- Submit Button -->
  <div class="button-row">
    <button mat-stroked-button color="accent" type="button" (click)="goBack()">â† Back</button>
    <button mat-raised-button color="primary" type="submit">Submit</button>
  </div>
</form>
